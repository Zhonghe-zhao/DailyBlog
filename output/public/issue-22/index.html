<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
      
    

      <title> - go-redis使用</title>

      
          
          <link rel="alternate" type="application/rss+xml" title="RSS" href="https://Zhonghe-zhao.github.io/DailyBlog/rss.xml">
          
      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https://Zhonghe-zhao.github.io/DailyBlog/site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;" class="logo"></a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;&#x2F;tags&#x2F;top&#x2F;">
                            Top
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;&#x2F;issue-34&#x2F;">
                            About
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;&#x2F;issue-35&#x2F;">
                            Things I like
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;"></a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;&#x2F;tags&#x2F;top&#x2F;">
                                    Top
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;&#x2F;issue-34&#x2F;">
                                    About
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;&#x2F;issue-35&#x2F;">
                                    Things I like
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://Zhonghe-zhao.github.io/DailyBlog/issue-22/#redis" class="toc-link">Redis</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://Zhonghe-zhao.github.io/DailyBlog/issue-22/#wei-shen-me-yao-cao-zuo-shu-ju-jie-gou" class="toc-link">为什么要操作数据结构？</a>
                        </li>
                        
                        <li>
                            <a href="https://Zhonghe-zhao.github.io/DailyBlog/issue-22/#redisnei-zhi-shu-ju-jie-gou" class="toc-link">Redis内置数据结构：</a>
                        </li>
                        
                        <li>
                            <a href="https://Zhonghe-zhao.github.io/DailyBlog/issue-22/#wen-ti" class="toc-link">问题：</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;issue-22&#x2F;">go-redis使用</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2025-06-15</span>
            
                <span class="post__source">
                    <a href="https:&#x2F;&#x2F;github.com&#x2F;Zhonghe-zhao&#x2F;DailyBlog&#x2F;issues&#x2F;22">read the source issue</a>
                </span>
            
            
        </div>
    </header>


    <div class="post-reactions">
        
        
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>

    <div class="post-content">
      <h1 id="redis">Redis</h1>
<p>高性能内存数据库：</p>
<p>为解决传统数据库在高并发和低延迟场景下的性能瓶颈</p>
<p>传统数据库 I/O 慢，不适合做高频缓存</p>
<p>Memcached 只支持简单的 key-value，不能表达复杂业务</p>
<p>项目中很多需求本质上是“操作数据结构”：列表、集合、计数器等</p>
<h2 id="wei-shen-me-yao-cao-zuo-shu-ju-jie-gou">为什么要操作数据结构？</h2>
<p>展示出最近的10条评论</p>
<p><code>SELECT * FROM comments WHERE post_id = ? ORDER BY created_at DESC LIMIT 10 OFFSET x</code></p>
<h2 id="redisnei-zhi-shu-ju-jie-gou">Redis内置数据结构：</h2>
<p>（String、Hash、List、Set、Sorted Set 等）</p>
<p>根据情况 <strong>选择合适的数据结构</strong></p>
<ol>
<li>字符串</li>
</ol>
<p>缓存用户姓名：SET user:1:name "Alice".</p>
<p>页面访问计数：INCR page:views.</p>
<p>数据量小，操作简单（读写、增减）。</p>
<ol start="2">
<li>Hash（哈希）</li>
</ol>
<p>存储用户信息：HSET user:1 name "Alice" age 25.</p>
<p>更新年龄：HSET user:1 age 26.</p>
<ol start="3">
<li>List（列表）</li>
</ol>
<p>任务队列：LPUSH tasks "send_email"，RPOP tasks.</p>
<p>最近浏览记录：LPUSH user:1:history "item1", LTRIM user:1:history 0 9（保留最近 10 条）。</p>
<ol start="4">
<li>Set（集合）</li>
</ol>
<p>用户标签：SADD user:1:tags "tech" "sports".</p>
<p>共同好友：SINTER user:1:friends user:2:friends.</p>
<p>用 Set 实现推荐系统（比如推荐共同兴趣的用户）。</p>
<ol start="5">
<li>Sorted Set（有序集合）</li>
</ol>
<p>游戏排行榜：ZADD leaderboard 100 "Alice".</p>
<p>获取前 3 名：ZREVRANGE leaderboard 0 2.</p>
<h2 id="wen-ti">问题：</h2>
<p>“如何用 Redis 做缓存？”（String/Hash）</p>
<p>“如何实现消息队列？”（List）</p>
<p>“如何设计排行榜？”（Sorted Set）</p>
<p>为什么选这个数据结构？ 它的优点！</p>
<p>##问题</p>
<p>为什么redis可以操作列表等数据结构呢？ 它的底层就是一个哈希表吗？</p>
<p>Redis 的全局键值存储是基于哈希表（Dict）</p>
<p>全局哈希表只存储「键」和「值的指针」</p>
<p>对于Redis 不同数据类型有不同的底层实现</p>
<p>实际上：</p>
<p>以 <em>LPUSH mylist A</em> 为例：</p>
<ol>
<li>
<p>查找 Key：先在全局哈希表中查找 "mylist"：</p>
</li>
<li>
<p>如果不存在，创建一个新的 List（底层可能是 QuickList）。</p>
</li>
<li>
<p>如果存在，拿到指向 List 的指针。</p>
</li>
<li>
<p>操作数据结构：调用 QuickList 的插入逻辑，在头部插入 "A"。</p>
</li>
</ol>

    </div>

    

    
        <div class="post-comments">
            
                <div class="comment-item">
                    <div class="comment-author">
                        <a href="https:&#x2F;&#x2F;github.com&#x2F;Zhonghe-zhao&#x2F;DailyBlog&#x2F;issues&#x2F;22#issuecomment-2974914808">
                            <img src="https:&#x2F;&#x2F;avatars.githubusercontent.com&#x2F;u&#x2F;147113943?v=4" alt="avatar">
                            <span class="comment-author-name">Zhonghe-zhao</span>
                            <span class="comment-date">2025-06-16 02:17</span>
                        </a>
                    </div>
                    <div class="comment-content">
                        <h2 id="getset">Getset</h2>
<p>GETSET key value 是一个 Redis 命令，原子性地执行以下操作：
获取（GET）：返回指定键 key 的当前值（如果存在）。
设置（SET）：将 key 的值设置为新值 value。</p>
<p>SET counter 10</p>
<p>GETSET counter 20  # 返回: 10，counter 现在是 20</p>
<p>保证在并发场景下不会出现数据竞争 ， 计数器更新：获取当前计数并更新为新值（如统计页面访问量）。</p>
<p>相比于关系型数据库：</p>
<p>开启事务。</p>
<p>SELECT 查询键对应的值。</p>
<p>UPDATE 更新值为新值。</p>
<p>提交事务。</p>
<h2 id="setnx">SetNX</h2>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">SETNX key value
</code></pre>
<p>当 key 不存在时，设置它的值为 value（返回 1）；如果 key 已存在，则不做任何操作（返回 0）。</p>
<h3 id="fen-bu-shi-suo">分布式锁</h3>
<p>在分布式系统中控制多个进程/服务互斥访问共享资源的机制。它的核心目标是：在分布式环境下，确保同一时刻只有一个客户端能执行关键操作（如修改数据、触发任务等）。</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh"># 加锁（推荐方式，原子性设置键值+过期时间）
SET lock:order 随机唯一值 EX 30 NX

# 解锁（需用 Lua 脚本保证原子性）
EVAL &quot;if redis.call(&#x27;GET&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;DEL&#x27;, KEYS[1]) else return 0 end&quot; 1 lock:order 随机唯一值
</code></pre>
<p><strong>问题：</strong></p>
<p>对于类似 防止重复下单 定时任务调度  避免并发更新数据 怎么应对这些场景？对于pg 和 redis等数据库都有什么应对措施？</p>
<p>完善秒杀系统</p>
<p>##MGet</p>
<p>批量查询：</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">MGET key [key ...]
</code></pre>
<p>减少网络开销：只需一次网络往返</p>
<h2 id="mset">MSet</h2>
<p>批量设置</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">MSET key value [key value ...]
</code></pre>
<p>结合Redis 对于 Pg的操作应该思考怎么去做</p>
<h3 id="huan-cun-yu-re">缓存预热</h3>
<p>##Incr IncrBy</p>
<p>原子性递增数字</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">INCR key
</code></pre>
<p>将 key 中存储的数字值增加1, 如果 key 不存在，会先初始化为 0 再执行加1操作</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">INCRBY key increment
</code></pre>
<p>将 key 中存储的数字值增加指定的整数值</p>
<p><strong>应用场景：</strong></p>
<p>文章阅读量统计</p>
<p>视频播放次数</p>
<p>用户点赞数</p>
<p>商品点击量</p>
<p>传统计数：性能低下：需要3次操作（GET+计算+SET） 容易导致数据竞争！</p>
<h3 id="yuan-zi-xing-nei-bu-dao-di-shi-zen-me-cao-zuo-de-neng-bi-mian-jing-zheng">原子性内部到底是怎么操作的能避免竞争？</h3>
<p>所有客户端命令都进入一个队列, 单一线程（主线程）顺序从队列取出并执行命令,即使服务器有多个CPU核心，Redis核心操作也只用单线程处理</p>
<h3 id="wei-shen-me-redisshi-yong-dan-xian-cheng-huan-neng-gao-xing-neng">为什么Redis使用单线程还能高性能</h3>
<p>纯内存操作：没有磁盘IO瓶颈</p>
<p>高效数据结构 ：</p>
<p>IO多路复用： 使用epoll/kqueue处理网络IO</p>

                    </div>
                </div>
            
        </div>
    

    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https://Zhonghe-zhao.github.io/DailyBlog/tags/go/">#Go</a>
                    
                        <a href="https://Zhonghe-zhao.github.io/DailyBlog/tags/backend/">#Backend</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;issue-23&#x2F;">‹ 地址和字节的关系</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;Zhonghe-zhao.github.io&#x2F;DailyBlog&#x2F;issue-21&#x2F;">数据库 ›</a>
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https://Zhonghe-zhao.github.io/DailyBlog/even.js" ></script>
      
    </body>

</html>
